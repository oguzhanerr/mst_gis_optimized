# Phase 5 Production Module Implementation Plan
## Overview
Implement Phase 5 as a production Python module that:
* Loads CSV profiles generated by Phase 4
* Processes each profile through ITU-R P.1812-6 bt_loss() function
* Calculates basic transmission loss (Lb) and electric field strength (Ep)
* Outputs results as structured DataFrame and CSV file
Goal: Clean, focused module without GeoJSON complexity from load_profiles_use_p1812.py
## Current State
* Phase 5 notebook demonstration created: notebooks/mobile_get_input_phase5.ipynb
* Existing reference script: load_profiles_use_p1812.py (has unnecessary GeoJSON code)
* Phases 0-4 production modules complete (2,600+ lines)
* Need: Production-grade Phase 5 module with full type hints, docs, error handling
## Deliverables
### 1. Production Module: src/mst_gis/pipeline/p1812_analysis.py
* ProfileLoader: Load and validate CSV profiles
* LossCalculator: Execute P.1812 bt_loss() for profiles
* ResultsExporter: Export results to CSV/DataFrame
* Main function: analyze_profiles() for full pipeline
* ~350-400 lines of code
* 100% type-hinted with comprehensive docstrings
* Full error handling and validation
### 2. CLI Entry Point: scripts/run_phase5_analysis.py
* Load profiles from data/input/profiles/
* Execute Phase 5 analysis
* Export results to data/output/spreadsheets/p1812_results.csv
* CLI args: --profiles-dir, --output-dir, --skip-export
* ~100 lines
### 3. Update Orchestration
* Add run_phase5_analysis() method to PipelineOrchestrator
* Integrate into run_full_pipeline() workflow (phases 0-5)
* Update run_pipeline() convenience function
### 4. Documentation Updates
* Update PIPELINE.md with Phase 5 details
* Add Phase 5 to README.md pipeline diagram
* Update API_REFERENCE.md with Phase 5 API
* Document output format in data/output/spreadsheets/
## Architecture
### p1812_analysis.py Module Structure
```warp-runnable-command
ProfileLoader
  ├── load_profiles(profiles_dir) → List[List[str]]
  └── validate_profile_format(profile) → bool
LossCalculator
  ├── parse_parameters(profile) → Tuple[...]
  └── calculate_loss(parameters) → Tuple[float, float]
ResultsExporter
  ├── prepare_dataframe(results) → DataFrame
  ├── export_csv(df, output_path) → Path
  └── get_statistics(df) → Dict[str, float]
Main Function
  └── analyze_profiles(profiles_dir, output_dir) → Tuple[DataFrame, Path]
```
### Data Structures
Input: CSV profiles from Phase 4 with columns:
* f, p, d[], h[], R[], Ct[], zone[], htg, hrg, pol, phi_t, phi_r, lam_t, lam_r, azimuth
Output DataFrame:
* profile_id, frequency_ghz, time_percentage, polarization
* tx_lat, tx_lon, rx_lat, rx_lon
* antenna_height_tx_m, antenna_height_rx_m
* max_distance_km, num_distance_points
* Lb_dB, Ep_dBuV_m
## Implementation Steps
### Step 1: Create p1812_analysis.py
* ProfileLoader class with CSV parsing
* LossCalculator with P.1812 bt_loss() wrapper
* ResultsExporter with DataFrame/CSV output
* Main analyze_profiles() function
* Error handling for invalid profiles
* Performance tracking
### Step 2: Create CLI Script
* run_phase5_analysis.py entry point
* Argument parsing (--profiles-dir, --output-dir, etc.)
* Integration with orchestrator
* User-friendly output and progress tracking
### Step 3: Update Orchestration
* PipelineOrchestrator.run_phase5_analysis()
* Integration into full pipeline execution
* State tracking for Phase 5 completion
### Step 4: Documentation
* PIPELINE.md Phase 5 section
* README.md pipeline workflow update
* API_REFERENCE.md Phase 5 API examples
* Output format specification
## Performance Targets
* Load profiles: <1s for 36 profiles
* Calculate all losses: 1-5s (depends on P.1812 complexity)
* Export CSV: <1s
* Total Phase 5: <10s for typical workload
## Testing Considerations
* Mock P.1812 bt_loss() for unit tests
* Test profile parsing with valid/invalid inputs
* Verify output DataFrame structure
* Check CSV export format
* Error handling for missing/corrupted profiles
## Not Included
* GeoJSON generation (removed from scope)
* Visualization (moved to notebook)
* Database storage (future enhancement)
* Real-time streaming (future enhancement)
